name: Rust Style

on: [push]

env:
  CARGO_TERM_COLOR: always

jobs:
  machete:
    name: Cargo Machete
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4
      - name: Install cargo-machete
        run: |
          cargo install cargo-machete

      - name: Check for unused dependencies
        run: |
          cargo machete
          exit_code=$?
          if [ $exit_code != 0 ]; then
            echo "Found unused dependencies. Run `cargo machete` locally and remove the matches or include them to ignored."
            exit $exit_code
          fi
